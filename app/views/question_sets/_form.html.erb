<%= form_with(model: question_set, local: true) do |form| %>
  <% if question_set.errors.any? %>
    <div id="error_explanation">
      <h2><%= pluralize(question_set.errors.count, "error") %> prohibited this question_set from being saved:</h2>

      <ul>
      <% question_set.errors.full_messages.each do |message| %>
        <li><%= message %></li>
      <% end %>
      </ul>
    </div>
  <% end %>

  <div class="field">
    <%= form.label :name %>
    <%= form.text_field :name, id: :question_set_name %>
  </div>

  <strong>Available Questions:</strong>
  <div>
    <% @questions.each do |question|%>
        <p>
          <%= check_box_tag 'question_ids[]', question.id, !@unselected_questions.include?(question), :id => 'question_ids_#{question.id}' -%>
          <%= question.body -%>
        </p>
    <% end %>
  </div>

  <!-- check if current_user's courses have any questions
        and allow user to filter those questions by searching tags.-->
  <% if @questions.present? %>
    <!-- add "search bar" for tags and filter questions shown based on
          tag entered -->

    <input type="text" id="tagSearchInput" onkeyup="qSetQTagSearch()" placeholder="Search for question tags...">

    <table id="questionTagTable" border="1">
      <tr>
        <th></th>
        <th style="min-width:250px">Body</th>
        <th style="min-width:100px">Tags</th>
      </tr>
      <!-- loop thru questions from controller
            (questions associated with courses the current_user is
            a professor or assistant for) -->
      <% @questions.each do |q| %>
        <tr>
          <td><%= check_box_tag 'question_ids[]', q.id, false, :id => 'question_ids_#{q.id}' %>
          <td><%= q.body %></td>
          <td><%= q.tags.join(", ") %></td>
        </tr>
      <% end %>
    </table>
  <% else %>
    <!-- current_user's courses do not have any questions -->
    <p>There are no questions associated with the courses you teach. Please create a question to add to the question set.</p>
  <% end %>

  <div class="actions">
    <%= form.submit %>
  </div>
<% end %>

<script>
//NOTE: Only searches for one term with no additional spaces or punctuation.
function qSetQTagSearch() {
  //declare variables: serach input, table to search, filter for input, and table rows.
  var input, filter, table, tr
  input = document.getElementById("tagSearchInput");
  filter = input.value.toLowerCase();
  table = document.getElementById("questionTagTable");
  tr = table.getElementsByTagName("tr");

  //loop thru all table rows, and hide those that don't match the search input.
  for (i = 0; i < tr.length; i++) {
    //get tags column for this row
    td = tr[i].getElementsByTagName("td")[2];
    if (td) {
      if (td.innerHTML.toLowerCase().indexOf(filter) > -1) {
        tr[i].style.display = "";
      } else {
        tr[i].style.display= "none";
      }
    }
  }
}
</script>
